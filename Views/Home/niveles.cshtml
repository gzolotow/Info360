@{
    ViewData["Title"] = "Niveles";
    var usuario = ViewBag.user;
    var nivelUsuario = ViewBag.nivelUsuario;
    int nivelMax = nivelUsuario?.NivelActual ?? 1;
    int totalNiveles = 3; // Cambiar si agregás más niveles
}

<body>
    <header>
        <nav class="navbar fixed-top">
            <div class="container-fluid">

                <!-- Logo -->
                <img class="LogoHeader" src="/img/logo.png" alt="Ecoplay">

                <!-- Perfil -->
                <a class="foto" asp-controller="Home" asp-action="Perfil">
                    <img src="/img/default.png" alt="Perfil">
                </a>

                <!-- Botón menú -->
                <button class="Menu" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar"
                    aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                    <img src="/img/menu.png" alt="Abrir menú">
                </button>

                <!-- Offcanvas menú -->
                <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                    <div class="offcanvas-body d-flex flex-column justify-content-between">
                        <ul class="navbar-nav flex-grow-1 pe-3">

                            <li class="nav-item">
                                <a class="Inicio" asp-controller="Home" asp-action="Home">
                                    <img class="casa" src="/img/Inicio.png" alt="Inicio">
                                </a>
                                <h4>Inicio</h4>
                            </li>

                            <li class="nav-item">
                                <a class="perfil" asp-controller="Home" asp-action="Perfil">
                                    <img class="perfil" src="/img/perfil.png" alt="Perfil">
                                </a>
                                <h4>Perfil</h4>
                            </li>

                            <button class="btn-submenu" type="button" data-bs-toggle="offcanvas"
                                data-bs-target="#offcanvasConfig" aria-controls="offcanvasConfig">
                                <img class="config" src="/img/config.png" alt="Configuración">
                            </button>
                            <h4>Configuración</h4>

                            <button type="button" class="btn-offcanvas-cerrar" data-bs-dismiss="offcanvas"
                                aria-label="Cerrar">
                                <img class="Cerrar" src="/img/cerrarMenu.png" alt="Cerrar menú">
                            </button>
                         
                        </ul>
                    </div>
                </div>

                <!-- Offcanvas configuración -->
                <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasConfig" aria-labelledby="offcanvasConfigLabel">
                    <div class="offcanvas-header"></div>
                    <div class="offcanvas-body config-body text-center">
                        <!-- Música -->
                        <div class="config-item">
                            <img src="/img/musica.png" alt="Música" class="musica">
                            <a href="#"><img src="/img/check.png" alt="Activado" class="config-icon"></a>
                        </div>

                        <!-- Volumen -->
                        <div class="config-item">
                            <img src="/img/volumen.png" alt="Volumen" class="volumen">
                            <input type="range" id="volumeSlider" min="0" max="100" value="80" class="rango">
                            <span id="volumeLabel" class="rango">Alto</span>

                            <!-- Términos y condiciones -->
                            <button class="btn-cerrar" type="button" data-bs-toggle="offcanvas"
                                data-bs-target="#offcanvasCenter" aria-controls="offcanvasCenter">
                                términos y condiciones
                            </button>

                            <!-- Cerrar overlay -->
                            <button class="close" type="button" data-bs-dismiss="offcanvas" aria-label="Close">
                                <img src="/img/cerrarOverlay.png" alt="">
                            </button>
                            
                        </div>
                    </div>
                </div>

                <!-- Script volumen -->
                <script>
                    document.addEventListener("DOMContentLoaded", () => {
                        const slider = document.getElementById('volumeSlider');
                        const label = document.getElementById('volumeLabel');

                        if (slider && label) {
                            slider.addEventListener('input', () => {
                                const value = slider.value;
                                if (value >= 70) label.textContent = 'Alto';
                                else if (value >= 40) label.textContent = 'Medio';
                                else if (value > 0) label.textContent = 'Bajo';
                                else label.textContent = 'Mute';
                            });
                        }
                    });
                </script>

            </div>
        </nav>
    </header>

    <main>
        <div class="niveles-container">

            <!-- Botón Volver -->
            <section class="boton">
                <a asp-controller="Home" asp-action="Home" class="col1 row1">
                    <img src="/img/salir.png" alt="salir">
                </a>
            </section>

            <!-- Botón Misiones -->
            <a href="@Url.Action("Misiones", "Home")" class="niveles-btn-misiones">Misiones</a>

            <!-- SVG de líneas -->
            <svg class="niveles-conexiones-svg" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path d="M 15 65 C 15 50, 25 35, 40 35" stroke="black" stroke-width="3" fill="none"/>
                <path d="M 40 35 C 55 35, 50 65, 65 65" stroke="black" stroke-width="3" fill="none"/>
                <path d="M 65 65 C 80 65, 75 35, 90 35" stroke="black" stroke-width="3" fill="none"/>
            </svg>

            <!-- Niveles dinámicos -->
            @for (int i = 1; i <= totalNiveles; i++)
            {
                if (i <= nivelMax)
                {
                    <a href="@Url.Action("Nivel" + i, "Home")" class="niveles-nodo niveles-nodo-@i" id="nivel@i">
                        NIVEL @i
                    </a>
                }
                else
                {
                    <div class="niveles-nodo niveles-nodo-@i niveles-bloqueado" id="nivel@i">
                        <span class="niveles-candado">&#128274;</span>
                        NIVEL @i
                    </div>
                }
            }
        </div>

        <!-- Overlay Tutorial -->
        <div id="tutorial-overlay" class="overlay" style="display:none;">
            <div class="overlay-content">
                <button class="overlay-close" onclick="cerrarOverlay()"><p>X</p></button>
                <img src="/img/tutorial.png" alt="Tutorial" class="overlay-img" />
            </div>
        </div>

        <script>
            function abrirOverlay() {
                document.getElementById('tutorial-overlay').style.display = 'flex';
            }
            function cerrarOverlay() {
                document.getElementById('tutorial-overlay').style.display = 'none';
            }
        </script>

        <!-- Offcanvas términos y condiciones -->
        <div class="offcanvas offcanvas-center" tabindex="-1" id="offcanvasCenter" aria-labelledby="offcanvasCenterLabel">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasCenterLabel">Términos y condiciones</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
            </div>
            <div class="offcanvas-body">
                <p>
                    1. Aceptación de los términos...
                    <!-- (Texto de términos y condiciones) -->
                </p>
                <button class="btn" data-bs-dismiss="offcanvas">Cerrar</button>
            </div>
        </div>
    </main>
</body>
